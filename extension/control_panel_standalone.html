<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AXIPLAT Server Control Panel</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #0b0c10 0%, #1a1d29 100%);
            color: #f4f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: #14171f;
            border: 1px solid #1f2230;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        h1 {
            margin: 0 0 8px;
            color: #8ac6f2;
            font-size: 1.8rem;
        }
        .subtitle {
            color: #9ea7c6;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }
        .status-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 12px;
        }
        .status-indicator.offline {
            color: #ff7675;
        }
        .status-indicator::before {
            content: "";
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        .status-indicator.offline::before {
            background: #ff7675;
        }
        .info-text {
            color: #9ea7c6;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .section-title {
            color: #8ac6f2;
            font-size: 1.1rem;
            margin-bottom: 12px;
        }
        .download-btn {
            display: inline-block;
            padding: 12px 24px;
            background: #6c5ce7;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.2s;
            margin: 8px 8px 8px 0;
            cursor: pointer;
        }
        .download-btn:hover {
            background: #5a4fcf;
        }
        .download-btn.secondary {
            background: #1f2230;
        }
        .download-btn.secondary:hover {
            background: #2a2d3f;
        }
        .instructions {
            background: rgba(255,255,255,0.03);
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 0.9rem;
            line-height: 1.8;
        }
        .instructions code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #55efc4;
        }
        .note {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 0.85rem;
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ AXIPLAT Server</h1>
        <p class="subtitle">Control Panel & Download Center</p>
        
        <div class="status-card">
            <div id="statusIndicator" class="status-indicator offline">
                Server Status: Checking...
            </div>
            <div id="statusText" class="info-text">Connecting to server...</div>
        </div>

        <div class="section">
            <div class="section-title">üì• Download AXIPLAT Launcher</div>
            <p class="info-text">Download a portable launcher that runs the server in the background (hidden).</p>
            
            <button class="download-btn" onclick="downloadFile('start_server_portable.bat'); return false;">
                ‚¨áÔ∏è Download Portable Launcher (Recommended)
            </button>
            <button class="download-btn secondary" onclick="downloadFile('start_server_hidden_portable.bat'); return false;">
                ‚¨áÔ∏è Download Hidden Portable Launcher
            </button>
            <button class="download-btn secondary" onclick="copyToClipboard('start_server_portable.bat'); return false;" title="Copy file content to clipboard">
                üìã Copy to Clipboard (Alternative)
            </button>
            
            <div class="instructions">
                <strong>Portable Launchers - No Setup Required!</strong><br>
                ‚Ä¢ Can run from anywhere - desktop, downloads folder, etc.<br>
                ‚Ä¢ Automatically downloads/clones the project if needed<br>
                ‚Ä¢ Sets up Python environment and dependencies automatically<br>
                ‚Ä¢ Just double-click and wait for first-time setup (2-5 minutes)<br>
                ‚Ä¢ Subsequent runs start instantly<br><br>
                <strong>Requirements:</strong> Python and Git installed (Git only needed for first-time clone)
            </div>
        </div>

        <div class="section">
            <div class="section-title">‚öôÔ∏è Auto-Start on Boot (Windows)</div>
            <p class="info-text">Make the server start automatically when Windows boots.</p>
            <button class="download-btn secondary" onclick="downloadFile('setup_autostart.bat')">
                üìã Download Auto-Start Setup
            </button>
            <div class="instructions">
                Run <code>setup_autostart.bat</code> to add the server to Windows startup.<br>
                The server will run hidden in the background on every boot.
            </div>
        </div>

        <div class="section">
            <div class="section-title">üìã Manual Setup</div>
            <div class="instructions">
                <strong>If you don't have the project folder:</strong><br>
                1. Clone the repository: <code>git clone https://github.com/Hari-Narayana-Rath/axiplat.git</code><br>
                2. Follow the setup instructions in README.md<br>
                3. Download and use the launcher files above
            </div>
        </div>
    </div>

    <script>
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');

        async function checkServerStatus() {
            try {
                const response = await fetch('http://localhost:5000/status');
                const data = await response.json();
                
                if (response.ok) {
                    statusIndicator.textContent = '‚úì Server Online';
                    statusIndicator.className = 'status-indicator online';
                    statusIndicator.style.color = '#55efc4';
                    statusIndicator.querySelector('::before')?.style.setProperty('background', '#55efc4');
                    statusText.textContent = `Server is running on localhost:5000. Age gate is active.`;
                } else {
                    throw new Error('Server not responding');
                }
            } catch (error) {
                statusIndicator.textContent = '‚úó Server Offline';
                statusIndicator.className = 'status-indicator offline';
                statusText.textContent = 'Server is not running. Download and run the launcher above to start it.';
            }
        }

        // Launcher scripts live inline so downloads work even when offline
        const fileContents = {
            'start_server_portable.bat': `@echo off
REM Age Gate Server - Portable Standalone Launcher
REM This script can run from anywhere and will set up everything automatically

setlocal enabledelayedexpansion

REM Get the directory where this batch file is located
set "BAT_DIR=%~dp0"
cd /d "%BAT_DIR%"

echo ========================================
echo Age Gate Server - Portable Launcher
echo ========================================
echo.

REM Check if Python is installed
python --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] Python is not installed or not in PATH.
    echo.
    echo Please install Python from https://www.python.org/
    echo Make sure to check "Add Python to PATH" during installation.
    echo.
    pause
    exit /b 1
)

echo [OK] Python found
echo.

REM Check if we're in a project folder (has app.py)
if exist "app.py" (
    echo [OK] Project folder detected
    set "PROJECT_DIR=%BAT_DIR%"
    goto :setup_server
)

REM Not in project folder - check if we should clone/download
echo [INFO] Not in project folder. Setting up...
echo.

REM Option 1: Check if there's a project folder nearby
if exist "..\\app.py" (
    echo [OK] Found project folder in parent directory
    set "PROJECT_DIR=%~dp0.."
    cd /d "!PROJECT_DIR!"
    goto :setup_server
)

REM Option 2: Clone from GitHub
echo [INFO] Cloning project from GitHub...
echo.

REM Check if git is available
git --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] Git is not installed.
    echo.
    echo Please either:
    echo 1. Place this .bat file in the project folder, OR
    echo 2. Install Git from https://git-scm.com/ and try again
    echo.
    pause
    exit /b 1
)

REM Clone the repository
set "REPO_URL=https://github.com/Hari-Narayana-Rath/axiplat.git"
set "CLONE_DIR=age_gate_server"

if exist "%CLONE_DIR%" (
    echo [INFO] Folder %CLONE_DIR% already exists, using it...
    set "PROJECT_DIR=%BAT_DIR%%CLONE_DIR%"
) else (
    echo [INFO] Cloning repository...
    git clone %REPO_URL% %CLONE_DIR%
    if errorlevel 1 (
        echo [ERROR] Failed to clone repository.
        echo.
        echo Please check your internet connection and try again.
        echo.
        pause
        exit /b 1
    )
    set "PROJECT_DIR=%BAT_DIR%%CLONE_DIR%"
)

echo [OK] Project cloned successfully
echo.

:setup_server
cd /d "!PROJECT_DIR!"

echo [INFO] Setting up server in: !PROJECT_DIR!
echo.

REM Check if virtual environment exists
if exist "venv\\Scripts\\activate.bat" (
    echo [OK] Virtual environment found
    goto :start_server
)

REM Create virtual environment
echo [INFO] Creating virtual environment...
python -m venv venv
if errorlevel 1 (
    echo [ERROR] Failed to create virtual environment.
    pause
    exit /b 1
)

echo [OK] Virtual environment created
echo.

REM Install dependencies
echo [INFO] Installing dependencies...
echo This may take a few minutes on first run...
echo.

call venv\\Scripts\\activate.bat
pip install --upgrade pip --quiet
pip install -r requirements.txt --quiet

if errorlevel 1 (
    echo [ERROR] Failed to install dependencies.
    echo.
    echo Please check your internet connection and try again.
    pause
    exit /b 1
)

echo [OK] Dependencies installed
echo.

:start_server
echo [INFO] Starting server...
echo.
echo Server will run in the background.
echo Access it at: http://localhost:5000
echo.
echo Press Ctrl+C in this window to stop the server.
echo (Or close this window)
echo.

REM Start server (visible window for now - user can minimize)
call venv\\Scripts\\activate.bat
python app.py

pause
`,
            'start_server_hidden_portable.bat': `@echo off
REM Age Gate Server - Portable Hidden Launcher
REM This script can run from anywhere and will set up everything automatically
REM Runs completely hidden in the background

setlocal enabledelayedexpansion

REM Get the directory where this batch file is located
set "BAT_DIR=%~dp0"
cd /d "%BAT_DIR%"

REM Check if Python is installed
python --version >nul 2>&1
if errorlevel 1 (
    REM Show error in a message box since we're running hidden
    mshta vbscript:Execute("msgbox ""Python is not installed. Please install Python from https://www.python.org/"", vbCritical, ""Age Gate Server Error"")(window.close)")
    exit /b 1
)

REM Check if we're in a project folder (has app.py)
if exist "app.py" (
    set "PROJECT_DIR=%BAT_DIR%"
    goto :setup_server
)

REM Check if project folder is in parent directory
if exist "..\\app.py" (
    set "PROJECT_DIR=%~dp0.."
    cd /d "!PROJECT_DIR!"
    goto :setup_server
)

REM Need to clone - but we can't show output when hidden
REM So we'll create a visible setup window first
set "REPO_URL=https://github.com/Hari-Narayana-Rath/axiplat.git"
set "CLONE_DIR=age_gate_server"
set "PROJECT_DIR=%BAT_DIR%%CLONE_DIR%"

if not exist "%CLONE_DIR%" (
    REM Show setup window
    start "" cmd /k "echo Cloning Age Gate Server... && git clone %REPO_URL% %CLONE_DIR% && echo. && echo Setup complete! You can close this window. && pause"
    REM Wait a bit for clone to start
    timeout /t 3 /nobreak >nul
    REM Check if clone completed (simple check - wait up to 60 seconds)
    set /a count=0
    :wait_loop
    if exist "%CLONE_DIR%\\app.py" goto :setup_server
    timeout /t 2 /nobreak >nul
    set /a count+=1
    if !count! geq 30 (
        REM Timeout - show error
        mshta vbscript:Execute("msgbox ""Setup is taking too long. Please run start_server_portable.bat instead for first-time setup."", vbCritical, ""Age Gate Server"")(window.close)")
        exit /b 1
    )
    goto :wait_loop
)

:setup_server
cd /d "!PROJECT_DIR!"

REM Check if virtual environment exists
if exist "venv\\Scripts\\activate.bat" (
    goto :start_server_hidden
)

REM Create venv and install (silently)
python -m venv venv >nul 2>&1
if errorlevel 1 exit /b 1

call venv\\Scripts\\activate.bat
pip install --upgrade pip --quiet >nul 2>&1
pip install -r requirements.txt --quiet >nul 2>&1

:start_server_hidden
REM Run server completely hidden using VBS
set "VBS_SCRIPT=%TEMP%\\age_gate_launcher_%RANDOM%.vbs"

(
echo Set WshShell = CreateObject^("WScript.Shell"^)
echo WshShell.CurrentDirectory = "!PROJECT_DIR!"
echo WshShell.Run "cmd /c ""!PROJECT_DIR!venv\\Scripts\\activate.bat && python app.py""", 0, False
) > "%VBS_SCRIPT%"

cscript //nologo "%VBS_SCRIPT%"
del "%VBS_SCRIPT%" >nul 2>&1

exit /b 0
`
        };

        async function downloadFile(filename) {
            try {
                console.log('Download requested:', filename);
                
                if (!fileContents[filename]) {
                    alert(`File ${filename} not available.\n\nPlease start the server first or clone from GitHub:\ngit clone https://github.com/Hari-Narayana-Rath/axiplat.git`);
                    return;
                }
                
                const content = fileContents[filename];
                console.log('File content length:', content.length);
                
                if (typeof chrome !== 'undefined' && chrome.downloads) {
                    try {
                        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                        const blobUrl = window.URL.createObjectURL(blob);
                        
                        await chrome.downloads.download({
                            url: blobUrl,
                            filename: filename,
                            saveAs: true
                        });
                        
                        setTimeout(() => window.URL.revokeObjectURL(blobUrl), 1000);
                        alert(`‚úì Download started: ${filename}\n\nCheck your Downloads folder.`);
                        return;
                    } catch (e) {
                        console.log('Chrome downloads API failed, trying fallback:', e);
                    }
                }
                
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const downloadUrl = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = filename;
                a.style.display = 'none';
                a.setAttribute('download', filename);
                
                document.body.appendChild(a);
                
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(downloadUrl);
                    console.log('Download completed:', filename);
                }, 100);
                
                setTimeout(() => {
                    alert(`‚úì Downloaded ${filename}!\n\nPlace it anywhere and double-click to start the server.\n\nIf download didn't work, try the "Copy to Clipboard" button instead.`);
                }, 300);
                
            } catch (error) {
                console.error('Download error:', error);
                alert(`Download failed: ${error.message}\n\nTry the "Copy to Clipboard" button instead, or clone from GitHub:\ngit clone https://github.com/Hari-Narayana-Rath/axiplat.git`);
            }
        }
        
        function copyToClipboard(filename) {
            try {
                if (!fileContents[filename]) {
                    alert(`File ${filename} not available.`);
                    return;
                }
                
                navigator.clipboard.writeText(fileContents[filename]).then(() => {
                    alert(`‚úì Copied ${filename} to clipboard!\n\nNow:\n1. Open Notepad\n2. Paste (Ctrl+V)\n3. Save as ${filename}\n4. Double-click to run`);
                }).catch(err => {
                    const textarea = document.createElement('textarea');
                    textarea.value = fileContents[filename];
                    textarea.style.position = 'fixed';
                    textarea.style.opacity = '0';
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert(`‚úì Copied ${filename} to clipboard!\n\nNow:\n1. Open Notepad\n2. Paste (Ctrl+V)\n3. Save as ${filename}\n4. Double-click to run`);
                });
            } catch (error) {
                alert(`Copy failed: ${error.message}`);
            }
        }
        
        window.downloadFile = downloadFile;
        window.copyToClipboard = copyToClipboard;

        checkServerStatus(); // paint initial state
        setInterval(checkServerStatus, 3000); // refresh UI frequently
    </script>
</body>
</html>

